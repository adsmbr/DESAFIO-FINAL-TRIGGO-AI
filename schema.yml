version: 2

sources:
  - name: bronze_source
    database: COVID19
    schema: BRONZE
    description: "Fontes de dados brutos do sistema COVID19"
    meta:
      data_classification: "sensitive"
      source_system: "DataSUS"
    tables:
      - name: RAW_LEITO_OCUPACAO_2020
      - name: RAW_LEITO_OCUPACAO_2021
<<<<<<< HEAD
        description: "Dados brutos de ocupa√ß√£o de leitos - 2021"
=======
      - name: RAW_LEITO_OCUPACAO_2022
>>>>>>> 7c846bdd4ec2a2c2bb6f86b8c2099aed5f344ef3
      - name: RAW_MUNICIPIOS_IBGE
        description: "Dados de munic√≠pios brasileiros - IBGE"
      - name: RAW_ESTABELECIMENTOS_CNES
        description: "Dados de estabelecimentos de sa√∫de - CNES"
      - name: RAW_LEITO_OCUPACAO_2020
        description: "Dados brutos de ocupa√ß√£o de leitos - 2020"
      - name: RAW_LEITO_OCUPACAO_2022
        description: "Dados brutos de ocupa√ß√£o de leitos - 2022"

models:
  - name: stg_leito_ocupacao_consolidado
<<<<<<< HEAD
    description: "Modelo de staging que consolida dados de ocupa√ß√£o de leitos de todos os anos (2020-2022)"
    meta:
      layer: "bronze"
      data_classification: "sensitive"
      test_strategy: "tolerant" # Permite alguns problemas menores na camada de staging
=======
    description: "Dados consolidados de ocupa√ß√£o de leitos de todos os anos (2020-2022)"
>>>>>>> 7c846bdd4ec2a2c2bb6f86b8c2099aed5f344ef3
    columns:
      - name: id_registro
        description: "Identificador √∫nico do registro"
        tests:
<<<<<<< HEAD
          - unique:
              config:
                severity: warn  # N√£o bloqueia em staging
          - not_null:
              config:
                severity: warn  # N√£o bloqueia em staging
      - name: data_notificacao
        description: "Data de notifica√ß√£o do registro"
        tests:
          - not_null:
              config:
                severity: warn  # Informativo apenas
      - name: cnes
        description: "C√≥digo do estabelecimento de sa√∫de (CNES)"
        tests:
          - not_null:
              config:
                severity: warn  # Informativo apenas
      - name: ano_dados
        description: "Ano de origem dos dados"
        tests:
          - not_null  # Cr√≠tico para particionamento
          - accepted_values:
              values: [2020, 2021, 2022]
              config:
                severity: error  # Bloqueia se ano inv√°lido
=======
          - unique
          - not_null
      - name: data_notificacao
        description: "Data da notifica√ß√£o"
        tests:
          - not_null
      - name: cnes
        description: "C√≥digo CNES do estabelecimento"
        tests:
          - not_null

  - name: int_leitos_ocupacao_unificado
    description: "Modelo intermedi√°rio que enriquece dados de staging com chaves de dimens√µes"
    columns:
      - name: id_registro
        description: "Identificador √∫nico do registro"
        tests:
          - unique
          - not_null
      - name: id_localidade
        description: "Chave estrangeira para dimens√£o localidade"
        tests:
          - not_null
          - relationships:
              to: ref('dim_localidade')
              field: id_localidade
>>>>>>> 7c846bdd4ec2a2c2bb6f86b8c2099aed5f344ef3

  - name: dim_tempo
    description: "Dimens√£o temporal com informa√ß√µes detalhadas sobre datas"
    meta:
      layer: "gold"
      data_classification: "public"
    columns:
      - name: id_tempo
        description: "Chave prim√°ria da dimens√£o tempo"
        tests:
          - unique
          - not_null
      - name: data
        description: "Data no formato DATE"
        tests:
<<<<<<< HEAD
          - not_null
      - name: ano
        description: "Ano extra√≠do da data"
        tests:
          - not_null
          - accepted_values:
              values: [2020, 2021, 2022]
      - name: trimestre
        description: "Trimestre do ano (1-4)"
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: semana_do_ano
        description: "Semana do ano (1-53)"
        tests:
=======
          - unique
>>>>>>> 7c846bdd4ec2a2c2bb6f86b8c2099aed5f344ef3
          - not_null

  - name: dim_localidade
    description: "Dimens√£o geogr√°fica com estados e munic√≠pios"
    meta:
      layer: "gold"
      data_classification: "public"
    columns:
      - name: id_localidade
        description: "Chave prim√°ria da dimens√£o localidade"
        tests:
          - unique
          - not_null
      - name: estado
        description: "Nome do estado"
        tests:
          - not_null
      - name: municipio
        description: "Nome do munic√≠pio"
        tests:
          - not_null
<<<<<<< HEAD
      - name: localidade_completa
        description: "Localidade formatada como 'Munic√≠pio - Estado'"
=======

  - name: dim_ocupacao_tipo
    description: "Dimens√£o com tipos de ocupa√ß√£o de leitos"
    columns:
      - name: id_ocupacao_tipo
        description: "Chave prim√°ria da dimens√£o tipo ocupa√ß√£o"
        tests:
          - unique
          - not_null
      - name: tipo_ocupacao
        description: "Tipo de ocupa√ß√£o (COVID, Hospitalar, etc.)"
        tests:
          - not_null
      - name: tipo_leito
        description: "Tipo de leito (Cl√≠nico, UTI)"
        tests:
          - not_null

  - name: dim_unidade_saude
    description: "Dimens√£o de unidades de sa√∫de (CNES)"
    columns:
      - name: id_unidade_saude
        description: "C√≥digo CNES da unidade de sa√∫de"
        tests:
          - unique
          - not_null
      - name: nome_unidade
        description: "Nome da unidade de sa√∫de"
        tests:
          - not_null

  - name: dim_cnes
    description: "Dimens√£o de estabelecimentos CNES com nomes"
    columns:
      - name: id_cnes
        description: "C√≥digo CNES do estabelecimento"
        tests:
          - unique
          - not_null
      - name: nm_estabelecimento
        description: "Nome do estabelecimento"
>>>>>>> 7c846bdd4ec2a2c2bb6f86b8c2099aed5f344ef3
        tests:
          - not_null

  - name: fact_ocupacao_leitos
    description: "Tabela de fatos com m√©tricas de ocupa√ß√£o de leitos"
    meta:
      layer: "gold"
      data_classification: "sensitive"
      contains_pii: false
      retention_period: "7_years"
    columns:
      - name: id_fato
        description: "Chave prim√°ria da tabela de fatos"
        tests:
          - unique
          - not_null
<<<<<<< HEAD
      - name: quantidade_leitos_ocupados
        description: "N√∫mero de leitos ocupados"
        tests:
          - not_null

  - name: data_integrity_monitoring
    description: "Modelo de monitoramento para problemas de integridade de dados"
    meta:
      layer: "monitoring"
      data_classification: "internal"
      purpose: "Fornece visibilidade sobre problemas de qualidade sem bloquear pipeline"
    columns:
      - name: check_type
        description: "Tipo de verifica√ß√£o realizada"
      - name: error_type
        description: "Tipo espec√≠fico de erro identificado"
      - name: total_registros
        description: "N√∫mero de registros afetados pelo problema"
      - name: percentual_afetado
        description: "Percentual dos dados afetados pelo problema"
      - name: status_visual
        description: "Status visual do problema (‚úÖ OK, ‚ö†Ô∏è Aten√ß√£o, üö® A√ß√£o)"
      - name: verificado_em
        description: "Timestamp da √∫ltima verifica√ß√£o"

  - name: silver_layer_investigation
    description: "Modelo de investiga√ß√£o para problemas na camada Silver (intermediate)"
    meta:
      layer: "monitoring"
      data_classification: "internal"
      purpose: "Identifica problemas de JOIN e integridade na camada intermediate"
    columns:
      - name: check_type
        description: "Tipo de an√°lise (SILVER_LAYER_ISSUE ou LOCALITY_ANALYSIS)"
      - name: problem_type
        description: "Tipo espec√≠fico de problema identificado"
      - name: affected_records
        description: "N√∫mero de registros afetados"
      - name: percentage_affected
        description: "Percentual dos dados afetados"
      - name: status
        description: "Status do problema com indicadores visuais"
      - name: checked_at
        description: "Timestamp da verifica√ß√£o"
=======
      - name: id_tempo
        description: "Chave estrangeira para dimens√£o tempo"
        tests:
          - not_null
          - relationships:
              to: ref('dim_tempo')
              field: id_tempo
      - name: id_localidade
        description: "Chave estrangeira para dimens√£o localidade"
        tests:
          - not_null
          - relationships:
              to: ref('dim_localidade')
              field: id_localidade
      - name: quantidade_leitos_ocupados
        description: "Quantidade de leitos ocupados"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
>>>>>>> 7c846bdd4ec2a2c2bb6f86b8c2099aed5f344ef3
